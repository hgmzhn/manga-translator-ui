# 翻译数据 JSON 格式说明文档

本文档旨在详细解释用于存储单张图片OCR与翻译结果的JSON文件的数据结构。

## 一、顶层结构

整个JSON文件是一个**字典 (Dictionary)**，其结构如下：

- **键 (Key)**: `string` 类型，值为进行翻译的原始图片在您电脑中的**绝对路径**。
  - 示例: `"C:\Users\徐浩文\manga-image-translator\001.jpeg"`
- **值 (Value)**: `list` 类型，一个列表，其中包含了在该图片上识别出的所有**文本区域 (Text Region)** 对象。

```json
{
  "C:\\Path\\To\\Your\\Image.jpg": [
    { ... 文本区域1 ... },
    { ... 文本区域2 ... },
    ...
  ]
}
```

---

## 二、文本区域 (Text Region) 对象

列表中的每一个元素都是一个独立的**字典 (Dictionary)**，代表图片上的一块文字区域。它包含了所有用于渲染和编辑该区域翻译文本所需的信息。

### 关键字段说明：

- `lines` (`list`): 定义了文本框精确轮廓的坐标点 `[x, y]` 列表。
  - **[核心]** 这里存储的是**未经旋转的、最原始的**多边形顶点坐标。它定义了文本框的“骨架”或基础形状。

- `angle` (`float`): 存储了该文本框需要旋转的角度值（单位：度）。

- `center` (`list`): 一个包含 `[x, y]` 两个元素的列表，定义了该文本框进行旋转时的**旋转中心点坐标**。该点是包裹住所有 `lines` 多边形的**最小外接矩形 (Bounding Box) 的中心**。

- `text` (`string`): OCR识别出的**原始文本**。

- `translation` (`string`): 经过翻译的**目标语言文本**。

- `font_size` (`int`): 渲染译文时使用的字体大小。

- `fg_colors` / `bg_colors` (`list`): 自动检测到的原始文本前景（文字）和背景色。

- 其他几何与样式字段: 如 `font_family`, `bold`, `xyxy`, `min_rect` 等，用于辅助编辑和渲染。

---

## 三、旋转逻辑说明

正确理解旋转如何工作至关重要。

1.  **数据分离**: JSON文件中将**形状 (`lines`)**、**旋转角度 (`angle`)** 和**旋转中心 (`center`)** 作为三个独立字段来存储。

2.  **渲染过程**:
    - 渲染引擎首先读取 `lines` 字段，获取文本框未经旋转的原始形状。
    - 然后，引擎会以 `center` 字段定义的坐标点为圆心。
    - 最后，将原始形状按照 `angle` 字段设定的角度进行旋转变换，最终得到您在屏幕上看到的旋转后的效果。

**总结: 文本框是围绕其外接矩形的中心点 (`center`)，旋转了 `angle` 度。**

---

## 四、文本区域的构成

一个“文本区域 (Text Region)”对象，**可以由多个分散的小块区域（多边形）构成**。

这是因为后台处理分为两步：
1.  **文字检测 (Detection)**: 程序首先在图片上检测出所有独立的、小段的**文本行 (Textline)**。每个文本行都有自己的一个小型多边形外框。
2.  **文本合并 (Merge)**: 接着，程序会将逻辑上相关的多个“文本行”合并成一个大的“文本区域”。例如，同一个气泡框内的多行文字会被合并。

这个过程反映在JSON数据中：

- `lines` (`list`): 这是一个**多边形列表**。如果一个文本区域是由3个文本行合并而来的，那么 `lines` 字段就会包含3个多边形坐标组。
- `texts` (`list`): 这是一个**字符串列表**，与 `lines` 字段一一对应，分别存储了每个小多边形区域内的独立文本。
- `text` (`string`): 这是 `texts` 列表中的所有文本合并后的**最终完整文本**。
